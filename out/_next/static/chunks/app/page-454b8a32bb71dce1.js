(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>d});var l=a(5155),s=a(2115),n=a(4253),o=a(2085),r=a(9434);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 aria-[pressed=true]:bg-accent aria-[pressed=true]:text-accent-foreground aria-[pressed=true]:hover:bg-accent/90 data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[active=true]:bg-accent data-[active=true]:text-accent-foreground data-[state=on]:bg-accent data-[state=on]:text-accent-foreground data-[state=on]:hover:bg-accent/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,size:o,asChild:d=!1,...c}=e,u=d?n.DX:"button";return(0,l.jsx)(u,{className:(0,r.cn)(i({variant:s,size:o,className:a})),ref:t,...c})});d.displayName="Button"},3067:(e,t,a)=>{Promise.resolve().then(a.bind(a,8888))},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>p});var l=a(2115);let s=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?o(a):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],d={toasts:[]};function c(e){d=r(d,e),i.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),l=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||l()}}}),{id:a,dismiss:l,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function p(){let[e,t]=l.useState(d);return l.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},8888:(e,t,a)=>{"use strict";a.d(t,{default:()=>eR});var l=a(5155),s=a(2115),n=a(7481),o=a(6824),r=a(9101),i=a.n(r);let d="#F97316",c={id:"drawn-polygon",type:"fill",paint:{"fill-color":d,"fill-opacity":.3,"fill-outline-color":d}},u={id:"drawn-polygon-line",type:"line",paint:{"line-color":d,"line-width":2}},p={id:"points-layer",type:"circle",source:"points-source",paint:{"circle-radius":8,"circle-color":["case",["boolean",["feature-state","selected"],!1],d,"#1D4ED8"],"circle-stroke-width":2,"circle-stroke-color":"#FFFFFF","circle-opacity":.8}},m=e=>{var t;let{mapRef:a,points:n,selectedPointIds:r,onPointClick:d,isDrawing:m,drawnPolygon:h,onMouseDown:x,onMouseUp:g,onMouseMove:f,onTouchStart:v,onTouchEnd:b,onTouchMove:j,onContextMenu:y,onMapClick:N,selectionMode:w,basemap:C}=e,[S,k]=(0,s.useState)(!1),A=(0,s.useMemo)(()=>({type:"FeatureCollection",features:n.map(e=>({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{id:e.id}}))}),[n]);(0,s.useEffect)(()=>{var e;if(S&&(null==(e=a.current)?void 0:e.getMap())){let e=a.current.getMap();if(!e.getSource("points-source"))return;n.map(e=>e.id).forEach(t=>{e.removeFeatureState({source:"points-source",id:t})}),r.forEach(t=>{e.setFeatureState({source:"points-source",id:t},{selected:!0})})}},[r,n,a,S]);let M=m&&h.length>1?{type:"Feature",geometry:{type:"Polygon",coordinates:[[...h.map(e=>[e.lng,e.lat]),[h[0].lng,h[0].lat]]]},properties:{}}:null,P=m&&h.length>0?{type:"Feature",geometry:{type:"LineString",coordinates:h.map(e=>[e.lng,e.lat])},properties:{}}:null;return(0,l.jsxs)(o.Ay,{ref:a,mapLib:i(),onLoad:()=>k(!0),initialViewState:{longitude:-46.6333,latitude:-23.5505,zoom:3},style:{width:"100%",height:"100%"},mapStyle:null!=(t=({voyager:"https://demotiles.maplibre.org/style.json","dark-voyager":"https://demotiles.maplibre.org/style.json",osm:"https://demotiles.maplibre.org/style.json",opentopo:{version:8,sources:{opentopo:{type:"raster",tiles:["https://a.tile.opentopomap.org/{z}/{x}/{y}.png","https://b.tile.opentopomap.org/{z}/{x}/{y}.png","https://c.tile.opentopomap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Map data: \xa9 OpenStreetMap contributors, SRTM | Style: \xa9 OpenTopoMap (CC-BY-SA)"}},layers:[{id:"opentopo",type:"raster",source:"opentopo",minzoom:0,maxzoom:17}]}})[C])?t:C,dragPan:"translate"!==w,onMouseDown:x,onMouseUp:g,onMouseMove:f,onTouchStart:v,onTouchEnd:b,onTouchMove:j,onContextMenu:y,onClick:N,cursor:"translate"===w?"move":m?"crosshair":"grab",interactiveLayerIds:["points-layer"],children:[(0,l.jsx)(o.T3,{position:"top-right"}),(0,l.jsx)(o.g0,{position:"bottom-left"}),S&&(0,l.jsx)(o.kL,{id:"points-source",type:"geojson",data:A,promoteId:"id",children:(0,l.jsx)(o.Wd,{...p})}),m&&P&&(0,l.jsx)(o.kL,{id:"drawing-line-source",type:"geojson",data:P,children:(0,l.jsx)(o.Wd,{...u})}),m&&M&&(0,l.jsx)(o.kL,{id:"drawing-polygon-source",type:"geojson",data:M,children:(0,l.jsx)(o.Wd,{...c})})]})};var h=a(5028),x=a(9572),g=a(8763),f=a(9119),v=a(5318),b=a(1573),j=a(9048),y=a(518),N=a(706),w=a(9968),C=a(285),S=a(9434);let k=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,l.jsx)("input",{type:s,className:(0,S.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});k.displayName="Input";var A=a(968);let M=(0,a(2085).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),P=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(A.b,{ref:t,className:(0,S.cn)(M(),a),...s})});P.displayName=A.b.displayName;var L=a(6981);let F=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(L.bL,{ref:t,className:(0,S.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,l.jsx)(L.C1,{className:(0,S.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(y.A,{className:"h-4 w-4"})})})});F.displayName=L.bL.displayName;let z=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});z.displayName="Card";let T=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("flex flex-col space-y-1.5 p-6",a),...s})});T.displayName="CardHeader",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let D=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("p-6 pt-0",a),...s})});D.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,S.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";var E=a(7655);let R=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,l.jsxs)(E.bL,{ref:t,className:(0,S.cn)("relative overflow-hidden",a),...n,children:[(0,l.jsx)(E.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,l.jsx)(I,{}),(0,l.jsx)(E.OK,{})]})});R.displayName=E.bL.displayName;let I=s.forwardRef((e,t)=>{let{className:a,orientation:s="vertical",...n}=e;return(0,l.jsx)(E.VM,{ref:t,orientation:s,className:(0,S.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...n,children:(0,l.jsx)(E.lr,{className:"relative flex-1 rounded-full bg-border"})})});I.displayName=E.VM.displayName;var V=a(3433),O=a(9556),q=a(7381);let U=V.bL;V.YJ;let B=V.WT,_=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,l.jsxs)(V.l9,{ref:t,className:(0,S.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[s,(0,l.jsx)(V.In,{asChild:!0,children:(0,l.jsx)(O.A,{className:"h-4 w-4 opacity-50"})})]})});_.displayName=V.l9.displayName;let $=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(V.PP,{ref:t,className:(0,S.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,l.jsx)(q.A,{className:"h-4 w-4"})})});$.displayName=V.PP.displayName;let Q=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(V.wn,{ref:t,className:(0,S.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,l.jsx)(O.A,{className:"h-4 w-4"})})});Q.displayName=V.wn.displayName;let G=s.forwardRef((e,t)=>{let{className:a,children:s,position:n="popper",...o}=e;return(0,l.jsx)(V.ZL,{children:(0,l.jsxs)(V.UC,{ref:t,className:(0,S.cn)("relative z-[9999] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...o,children:[(0,l.jsx)($,{}),(0,l.jsx)(V.LM,{className:(0,S.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,l.jsx)(Q,{})]})})});G.displayName=V.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(V.JU,{ref:t,className:(0,S.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=V.JU.displayName;let H=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,l.jsxs)(V.q7,{ref:t,className:(0,S.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,l.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(V.VF,{children:(0,l.jsx)(y.A,{className:"h-4 w-4"})})}),(0,l.jsx)(V.p4,{children:s})]})});H.displayName=V.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(V.wv,{ref:t,className:(0,S.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=V.wv.displayName;var Z=a(4059),J=a(154);let Y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(Z.bL,{className:(0,S.cn)("grid gap-2",a),...s,ref:t})});Y.displayName=Z.bL.displayName;let K=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(Z.q7,{ref:t,className:(0,S.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...s,children:(0,l.jsx)(Z.C1,{className:"flex items-center justify-center",children:(0,l.jsx)(J.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});K.displayName=Z.q7.displayName;var W=a(4073);let X=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsxs)(W.bL,{ref:t,className:(0,S.cn)("relative flex w-full touch-none select-none items-center",a),...s,children:[(0,l.jsx)(W.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,l.jsx)(W.Q6,{className:"absolute h-full bg-primary"})}),(0,l.jsx)(W.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});X.displayName=W.bL.displayName;let ee=e=>{var t,a;let{schema:n,onQueryChange:o,onApply:r,onClear:i,onToolFinish:d}=e,[c,u]=(0,s.useState)(null),[p,m]=(0,s.useState)("eq"),[h,x]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[v,b]=(0,s.useState)(""),[j,y]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{if(!c)return void o(null);let e=null;"number"===c.type?e="between"===p?{field:c.name,operator:p,min:parseFloat(g),max:parseFloat(v)}:{field:c.name,operator:p,value:parseFloat(h)}:"string"===c.type&&(e="in"===p?{field:c.name,operator:p,values:Array.from(j)}:{field:c.name,operator:p,value:h}),o(e)},[c,p,h,g,v,j,o]);let N=e=>{y(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{htmlFor:"attr-select-field",children:"Campo"}),(0,l.jsxs)(U,{onValueChange:e=>{var t,a;let l=n.fields.find(t=>t.name===e)||null;u(l),x(""),f(null!=(t=null==l?void 0:l.stats.min)?t:""),b(null!=(a=null==l?void 0:l.stats.max)?a:""),y(new Set),m((null==l?void 0:l.type)==="number"?"between":"in")},children:[(0,l.jsx)(_,{id:"attr-select-field",children:(0,l.jsx)(B,{placeholder:"Selecione um atributo"})}),(0,l.jsx)(G,{children:n.fields.filter(e=>"other"!==e.type).map(e=>(0,l.jsx)(H,{value:e.name,children:e.name},e.name))})]})]}),(null==c?void 0:c.type)==="number"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{children:"Operador"}),(0,l.jsxs)(U,{value:p,onValueChange:e=>m(e),children:[(0,l.jsx)(_,{children:(0,l.jsx)(B,{})}),(0,l.jsxs)(G,{children:[(0,l.jsx)(H,{value:"between",children:"Entre"}),(0,l.jsx)(H,{value:"eq",children:"Igual a"}),(0,l.jsx)(H,{value:"neq",children:"Diferente de"}),(0,l.jsx)(H,{value:"gte",children:"Maior ou igual a"}),(0,l.jsx)(H,{value:"lte",children:"Menor ou igual a"})]})]})]}),"between"===p?(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,l.jsx)(P,{htmlFor:"attr-min-val",children:"M\xednimo"}),(0,l.jsx)(k,{id:"attr-min-val",type:"number",value:g,onChange:e=>f(e.target.value),placeholder:null==(t=c.stats.min)?void 0:t.toString()})]}),(0,l.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,l.jsx)(P,{htmlFor:"attr-max-val",children:"M\xe1ximo"}),(0,l.jsx)(k,{id:"attr-max-val",type:"number",value:v,onChange:e=>b(e.target.value),placeholder:null==(a=c.stats.max)?void 0:a.toString()})]})]}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{htmlFor:"attr-val",children:"Valor"}),(0,l.jsx)(k,{id:"attr-val",type:"number",value:h,onChange:e=>x(e.target.value)})]})]}),(null==c?void 0:c.type)==="string"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{children:"Operador"}),(0,l.jsxs)(U,{value:p,onValueChange:e=>m(e),children:[(0,l.jsx)(_,{children:(0,l.jsx)(B,{})}),(0,l.jsxs)(G,{children:[(0,l.jsx)(H,{value:"in",children:"Est\xe1 em"}),(0,l.jsx)(H,{value:"eq",children:"Igual a"}),(0,l.jsx)(H,{value:"neq",children:"Diferente de"})]})]})]}),"in"===p?(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{children:"Valores"}),(0,l.jsx)(R,{className:"h-40 rounded-md border p-2",children:Array.from(c.stats.uniqueValues||[]).map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2 p-1",children:[(0,l.jsx)(F,{id:"check-"+e,checked:j.has(e),onCheckedChange:()=>N(e)}),(0,l.jsx)(P,{htmlFor:"check-"+e,className:"font-normal truncate",children:e})]},e))})]}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{htmlFor:"attr-val",children:"Valor"}),(0,l.jsx)(k,{id:"attr-val",type:"text",value:h,onChange:e=>x(e.target.value)})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(C.$,{onClick:()=>{r()},className:"flex-1",disabled:!c||("number"===c.type?"between"===p?isNaN(parseFloat(g))||isNaN(parseFloat(v)):isNaN(parseFloat(h)):"string"!==c.type||("in"===p?0===j.size:""===h)),children:"Aplicar Filtro"}),(0,l.jsx)(C.$,{onClick:i,variant:"outline",children:"Limpar"})]})]})},et=e=>{let{points:t,setPreviewIds:a,onApplyBatchSelection:n,onToolFinish:o}=e,r=t.length,[[i,d],c]=(0,s.useState)([1,r]),u=(e,a)=>{console.log("calculateIdsFromRange called with minVal:",e,"maxVal:",a),console.log("calculateIdsFromRange - points length:",t.length),console.log("calculateIdsFromRange - points sample:",t.slice(0,Math.min(5,t.length)).map(e=>({id:e.id,lat:e.lat,lon:e.lon})));let l=new Set,s=Math.max(0,Math.floor(e)-1),n=Math.min(r-1,Math.floor(a)-1);if(console.log("calculateIdsFromRange - calculated lower:",s,"upper:",n),s>n)return console.log("calculateIdsFromRange - invalid range, returning empty set"),l;for(let e=s;e<=n;e++)e<t.length?(console.log("calculateIdsFromRange - adding point at index",e,"with id",t[e].id),l.add(t[e].id)):console.log("calculateIdsFromRange - index",e,"out of bounds, points.length:",t.length);return console.log("calculateIdsFromRange - final ids set:",Array.from(l)),l};(0,s.useEffect)(()=>(a(u(1,r)),()=>{a(new Set)}),[]);let p=(e,t)=>{let l=parseInt(t,10);if(isNaN(l))return;let s=[i,d];"min"===e?s[0]=Math.max(1,Math.min(l,d)):s[1]=Math.min(r,Math.max(l,i)),c(s),a(u(s[0],s[1]))};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(P,{children:"Intervalo de Pontos (Ordem Natural)"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ajuste o intervalo para pr\xe9-visualizar a sele\xe7\xe3o (em amarelo). Clique em Aplicar para confirmar."}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(k,{type:"number",value:i,onChange:e=>p("min",e.target.value),className:"w-24",min:1,max:d}),(0,l.jsx)(X,{value:[i,d],onValueChange:e=>{c(e),a(u(e[0],e[1]))},max:r,min:1,step:1,className:"flex-1"}),(0,l.jsx)(k,{type:"number",value:d,onChange:e=>p("max",e.target.value),className:"w-24",min:i,max:r})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(C.$,{onClick:()=>{console.log("handleApply called with min:",i,"max:",d);let e=u(i,d);if(console.log("handleApply - idsToApply:",Array.from(e)),0===e.size)return void console.warn("No points to select in the given range");a(new Set),console.log("handleApply - applying batch selection (no explicit mode change)"),n(e)},className:"flex-1",children:"Aplicar Intervalo"}),(0,l.jsx)(C.$,{onClick:()=>{a(new Set),o("single")},variant:"outline",children:"Cancelar"})]})]})},ea=e=>{let{points:t,originalHeaders:a,selectedPoints:n,onUpdatePoint:o,onUpdateSelectedPoints:r,onTogglePointSelection:i,selectionMode:d,setPreviewIds:c,onApplyBatchSelection:u,onToolFinish:p,translationLock:m,onTranslationLockChange:h,translationDelta:S,onApplyTranslation:A,onSetTranslationValue:M,schema:L,onAttributeQueryChange:E,onApplyAttributeQuery:R}=e,[I,V]=(0,s.useState)(null),[O,q]=(0,s.useState)({}),[U,B]=(0,s.useState)({}),[_,$]=(0,s.useState)("attribute");(0,s.useEffect)(()=>{"attribute"!==d&&"batch-edit"!==d&&($("attribute"),c(new Set))},[d,c]);let Q=(0,s.useMemo)(()=>{console.log("Computing selectedPointsData:"),console.log("- selectedPoints:",n),console.log("- points length:",t.length),console.log("- points sample:",t.slice(0,Math.min(5,t.length)).map(e=>({id:e.id,lat:e.lat,lon:e.lon})));let e=t.filter(e=>{let t=n.includes(e.id);return t&&console.log("Point",e.id,"is selected"),t});return console.log("selectedPointsData result length:",e.length),e.length>0&&console.log("selectedPointsData sample:",e.slice(0,Math.min(3,e.length)).map(e=>({id:e.id,lat:e.lat,lon:e.lon}))),e},[t,n]),G=(0,s.useMemo)(()=>t.some(e=>null!==e.alt&&void 0!==e.alt),[t]),H=e=>{V(e.id);let{attributes:t,...a}=e;q({...t,...a})},Z=()=>{I&&O&&(o(I,O),V(null),q({}))},J=()=>{V(null),q({})},W=(e,t)=>{q(a=>({...a,[e]:"lat"===e||"lon"===e||"alt"===e?parseFloat(t)||0:t}))},X=(e,t)=>{q(a=>({...a,attributes:{...a.attributes,[e]:t}}))},ea=(e,t)=>{B(a=>({...a,[e]:t}))},el=()=>{let e={},t={};for(let a in U){let l=U[a];if(""!==l&&void 0!==l)if("lat"===a||"lon"===a||"alt"===a){let t=parseFloat(l);isNaN(t)||(e[a]=t)}else t[a]=l}Object.keys(t).length>0&&(e.attributes=t),Object.keys(e).length>0&&(r(e),B({}))},es=()=>{if("translate"===d)return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'Arraste no mapa para mover ou insira os deltas. Trave um eixo (Lat/Lon) para que o arrasto no outro eixo altere a altitude. Clique em "Aplicar" para salvar.'}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(F,{id:"lock-lat",checked:m.lat,onCheckedChange:e=>h("lat",!!e)}),(0,l.jsxs)(P,{htmlFor:"lock-lat",className:"flex items-center gap-2 flex-1",children:[m.lat?(0,l.jsx)(b.A,{className:"w-4 h-4"}):(0,l.jsx)(j.A,{className:"w-4 h-4"}),"Travar Latitude"]}),(0,l.jsx)(k,{value:S.dLat.toFixed(6),onChange:e=>M("dLat",parseFloat(e.target.value)||0),type:"number",step:"any",className:"w-28 h-8 text-xs",disabled:m.lat})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(F,{id:"lock-lon",checked:m.lon,onCheckedChange:e=>h("lon",!!e)}),(0,l.jsxs)(P,{htmlFor:"lock-lon",className:"flex items-center gap-2 flex-1",children:[m.lon?(0,l.jsx)(b.A,{className:"w-4 h-4"}):(0,l.jsx)(j.A,{className:"w-4 h-4"}),"Travar Longitude"]}),(0,l.jsx)(k,{value:S.dLon.toFixed(6),onChange:e=>M("dLon",parseFloat(e.target.value)||0),type:"number",step:"any",className:"w-28 h-8 text-xs",disabled:m.lon})]}),G&&(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(F,{id:"lock-alt",checked:m.alt,onCheckedChange:e=>h("alt",!!e)}),(0,l.jsxs)(P,{htmlFor:"lock-alt",className:"flex items-center gap-2 flex-1",children:[m.alt?(0,l.jsx)(b.A,{className:"w-4 h-4"}):(0,l.jsx)(j.A,{className:"w-4 h-4"}),"Travar Altitude"]}),(0,l.jsx)(k,{value:S.dAlt.toFixed(6),onChange:e=>M("dAlt",parseFloat(e.target.value)||0),type:"number",step:"any",className:"w-28 h-8 text-xs",disabled:m.alt})]})]}),(0,l.jsxs)(C.$,{onClick:A,className:"w-full",children:[(0,l.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"Aplicar Transla\xe7\xe3o"]})]});if("batch-edit"===d||"all"===d){var e,t,s;let n=a.filter(e=>!["lat","lon","alt"].some(t=>RegExp("^"+t+"$","i").test(e))),o=Q[0],r=e=>{let t;return o?"Manter valor original ("+(null!=(t="lat"===e?o.lat:"lon"===e?o.lon:"alt"===e?o.alt:o.attributes[e])?String(t):"")+")":""};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[(0,l.jsx)(N.A,{className:"w-4 h-4"}),"Edite os campos abaixo para atualizar todos os pontos selecionados. Deixe em branco para n\xe3o alterar."]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"batch-lat",children:"Latitude"}),(0,l.jsx)(k,{id:"batch-lat",type:"number",step:"any",placeholder:r("lat"),value:null!=(e=U.lat)?e:"",onChange:e=>ea("lat",e.target.value),className:"mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"batch-lon",children:"Longitude"}),(0,l.jsx)(k,{id:"batch-lon",type:"number",step:"any",placeholder:r("lon"),value:null!=(t=U.lon)?t:"",onChange:e=>ea("lon",e.target.value),className:"mt-1"})]}),G&&(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"batch-alt",children:"Altitude"}),(0,l.jsx)(k,{id:"batch-alt",type:"number",step:"any",placeholder:r("alt"),value:null!=(s=U.alt)?s:"",onChange:e=>ea("alt",e.target.value),className:"mt-1"})]}),(0,l.jsx)("hr",{className:"my-2"}),n.map(e=>{var t;return(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"batch-attr-"+e,children:e}),(0,l.jsx)(k,{id:"batch-attr-"+e,type:"text",placeholder:r(e),value:null!=(t=U[e])?t:"",onChange:t=>ea(e,t.target.value),className:"mt-1"})]},e)}),(0,l.jsxs)(C.$,{onClick:el,className:"w-full",children:["Aplicar",(0,l.jsx)(w.A,{className:"w-4 h-4 ml-2"})]})]})}return null};return(0,l.jsx)("div",{className:"p-4 h-full",children:(0,l.jsxs)(z,{className:"h-full flex flex-col",children:[(0,l.jsx)(T,{className:"pb-3"}),(0,l.jsx)(D,{className:"flex-1 overflow-y-auto p-4",children:(0,l.jsx)("div",{className:"space-y-4",children:(()=>{if(console.log("renderContent called:"),console.log("- selectionMode:",d),console.log("- selectionTool:",_),console.log("- selectedPointsData length:",Q.length),console.log("- selectedPointsData sample:",Q.slice(0,Math.min(3,Q.length)).map(e=>({id:e.id,lat:e.lat,lon:e.lon}))),"attribute"===d)return console.log("rendering attribute selection mode"),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-lg",children:[(0,l.jsx)(x.A,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"Sele\xe7\xe3o por Atributos"})]}),(0,l.jsxs)(Y,{value:_,onValueChange:e=>{console.log("RadioGroup onValueChange - v:",e),c(new Set),$(e)},className:"flex gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(K,{value:"attribute",id:"r-attr"}),(0,l.jsx)(P,{htmlFor:"r-attr",children:"Por Filtro"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(K,{value:"range",id:"r-range"}),(0,l.jsx)(P,{htmlFor:"r-range",children:"Por Intervalo"})]})]}),(0,l.jsx)("hr",{}),"attribute"===_?(0,l.jsx)(ee,{schema:L,onQueryChange:E,onApply:R,onClear:()=>E(null),onToolFinish:p}):(0,l.jsx)(et,{points:t,setPreviewIds:c,onApplyBatchSelection:u,onToolFinish:p})]});if(console.log("not in attribute mode, checking selected points"),0===Q.length&&"batch-edit"!==d)return console.log("no selected points and not in batch-edit mode, showing empty state"),(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center text-gray-500",children:[(0,l.jsx)("p",{className:"text-lg font-medium",children:"Nenhum ponto selecionado"}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"Clique em um ponto no mapa ou use as ferramentas de sele\xe7\xe3o"})]})});if(1===Q.length&&"single"===d){let e=Q[0],t=I===e.id,a=t?O:{...e,...e.attributes};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Propriedades do Ponto"}),t?(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)(C.$,{variant:"outline",size:"sm",onClick:Z,children:(0,l.jsx)(f.A,{className:"w-4 h-4"})}),(0,l.jsx)(C.$,{variant:"outline",size:"sm",onClick:J,children:(0,l.jsx)(v.A,{className:"w-4 h-4"})})]}):(0,l.jsx)(C.$,{variant:"outline",size:"sm",onClick:()=>H(e),children:(0,l.jsx)(g.A,{className:"w-4 h-4"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"point-id",children:"ID"}),(0,l.jsx)(k,{id:"point-id",value:e.id,disabled:!0,className:"mt-1"})]}),["lat","lon","alt"].map(e=>{var s;return"alt"!==e||G?(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"point-"+e,children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,l.jsx)(k,{id:"point-"+e,value:null!=(s=a[e])?s:"",onChange:t=>W(e,t.target.value),disabled:!t,type:"number",step:"any",className:"mt-1"})]},e):null}),Object.keys(e.attributes).map(e=>{var s;return(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{htmlFor:"point-attr-"+e,children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,l.jsx)(k,{id:"point-attr-"+e,value:null!=(s=a[e])?s:"",onChange:t=>X(e,t.target.value),disabled:!t,type:"text",className:"mt-1"})]},e)})]})}return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:[Q.length," Pontos Selecionados"]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto pr-4",children:(0,l.jsxs)("div",{className:"space-y-4",children:[es(),(0,l.jsx)("hr",{className:"my-4"}),(0,l.jsx)("p",{className:"text-sm font-medium mb-2",children:"Pontos selecionados:"}),(0,l.jsx)("div",{className:"space-y-2",children:Q.map(e=>(0,l.jsxs)("div",{className:"p-2 border rounded-md cursor-pointer hover:bg-gray-50 transition-colors text-xs",onClick:()=>i(e.id),children:[(0,l.jsxs)("div",{className:"font-medium truncate",children:["ID: ",e.id]}),(0,l.jsxs)("div",{className:"text-gray-600",children:["Lat: ",e.lat.toFixed(6),", Lon: ",e.lon.toFixed(6)]})]},e.id))})]})})]})})()})})]})})};var el=a(408),es=a.n(el),en=a(5821);let eo=e=>(0,l.jsx)(en.bL,{modal:!1,...e});en.l9;let er=en.ZL,ei=en.bm,ed=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(en.hJ,{ref:t,className:(0,S.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});ed.displayName=en.hJ.displayName;let ec=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,l.jsxs)(er,{children:[(0,l.jsx)(ed,{}),(0,l.jsxs)(en.UC,{ref:t,className:(0,S.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,(0,l.jsxs)(en.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(v.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ec.displayName=en.UC.displayName;let eu=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,S.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};eu.displayName="DialogHeader";let ep=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,S.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};ep.displayName="DialogFooter";let em=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(en.hE,{ref:t,className:(0,S.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});em.displayName=en.hE.displayName;let eh=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(en.VY,{ref:t,className:(0,S.cn)("text-sm text-muted-foreground",a),...s})});function ex(){let e="undefined"!=typeof globalThis&&globalThis.crypto||void 0;try{if(null==e?void 0:e.randomUUID)return e.randomUUID()}catch(e){}if(null==e?void 0:e.getRandomValues){let t=new Uint8Array(16);e.getRandomValues(t),t[6]=15&t[6]|64,t[8]=63&t[8]|128;let a=Array.from(t,e=>e.toString(16).padStart(2,"0")).join("");return"".concat(a.slice(0,8),"-").concat(a.slice(8,12),"-").concat(a.slice(12,16),"-").concat(a.slice(16,20),"-").concat(a.slice(20))}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}eh.displayName=en.VY.displayName;let eg={lon:/^(lon|lng|long|x|longitude)$/i,lat:/^(lat|y|latitude)$/i,alt:/^(alt|z|height|elev|altitude|altitude\(m\))$/i},ef=e=>{if("string"!=typeof e||""===e.trim())return null;let t=parseFloat(e.replace(",","."));return isNaN(t)?null:t},ev=e=>null==e||""===e.trim()?"other":isNaN(Number(e.replace(",",".")))||""===e.trim()?"string":"number",eb=(e,t)=>{let a=t.map(e=>({name:e,type:"other",stats:{uniqueValues:new Set}}));if(0===e.length)return{fields:a};let l=e.slice(0,100);return a.forEach(e=>{for(let t of l){let a=ev(t[e.name]);if("number"===a){e.type="number";break}"string"===a&&(e.type="string")}}),a.forEach(t=>{if("number"===t.type){let a=1/0,l=-1/0;e.forEach(e=>{let s=ef(e[t.name]);null!==s&&(s<a&&(a=s),s>l&&(l=s))}),t.stats.min=a===1/0?void 0:a,t.stats.max=l===-1/0?void 0:l}else"string"===t.type&&e.forEach(e=>{let a=e[t.name];if(null!=a){var l;null==(l=t.stats.uniqueValues)||l.add(a)}})}),{fields:a}},ej=(e,t)=>new Promise((a,l)=>{es().parse(e,{header:!0,skipEmptyLines:!0,complete:e=>{let s=e.meta.fields||[],n=e.data,{lat:o,lon:r,alt:i,heading:d,gimbalPitch:c}=t;if(!r||!o)return l(Error("As colunas de longitude e latitude s\xe3o obrigat\xf3rias."));if(!s.includes(r)||!s.includes(o))return l(Error("As colunas de coordenadas mapeadas n\xe3o foram encontradas no arquivo."));let u=eb(n,s);console.log("CSV parsing: data sample",n.slice(0,3)),console.log("CSV parsing: mappings",t);let p=n.map(e=>{let t=ef(e[r]),a=ef(e[o]);if(null===t||null===a||t<-180||t>180||a<-90||a>90)return console.warn("Invalid coordinates:",{lon:t,lat:a,row:e}),null;let l=i?ef(e[i]):0,s=d?ef(e[d]):0,n=c?ef(e[c]):0,p={};for(let t in e){let a=u.fields.find(e=>e.name===t);(null==a?void 0:a.type)==="number"?p[t]=ef(e[t]):p[t]=e[t]}p[o]=a,p[r]=t,i&&(p[i]=l),d&&(p[d]=s),c&&(p[c]=n);let m={id:ex(),lon:t,lat:a,alt:null!=l?l:0,heading:null!=s?s:0,gimbalPitch:null!=n?n:0,attributes:p};return console.log("CSV parsing: created point",m),m}).filter(e=>null!==e);console.log("CSV parsing: final points",p),a({points:p,headers:s,schema:u})},error:e=>l(e)})}),ey=(e,t)=>{let a="",l="",s;for(let e of t)eg.lon.test(e)&&(a=e),eg.lat.test(e)&&(l=e),eg.alt.test(e)&&(s=e);let n=e.map(e=>{var n;let o={...e.attributes};a&&(o[a]=e.lon),l&&(o[l]=e.lat),s&&(o[s]=null!=(n=e.alt)?n:"");let r={};for(let e of t)r[e]=o[e];return r});return es().unparse(n,{columns:t})},eN=e=>{let{isOpen:t,file:a,onClose:n,onSubmit:o}=e,[r,i]=(0,s.useState)([]),[d,c]=(0,s.useState)({}),[u,p]=(0,s.useState)(""),m=(0,s.useCallback)(e=>{let t,a,l,s,n;for(let o of e)!a&&eg.lon.test(o)&&(a=o),!t&&eg.lat.test(o)&&(t=o),!l&&eg.alt.test(o)&&(l=o),!s&&/heading/i.test(o)&&(s=o),!n&&/gimbal.*pitch/i.test(o)&&(n=o);c({lat:t,lon:a,alt:l,heading:s,gimbalPitch:n})},[]);(0,s.useEffect)(()=>{a&&es().parse(a,{header:!0,skipEmptyLines:"greedy",preview:1,complete:e=>{let t=e.meta.fields||[];if(0===t.length){var l;let e=es().parse(a,{header:!1,preview:1,skipEmptyLines:"greedy"});t=Array.from({length:Array.isArray(null==(l=e.data)?void 0:l[0])?e.data[0].length:0},(e,t)=>"col_".concat(t+1))}i(t),m(t)}})},[a,m]);let h=(e,t)=>{c(a=>({...a,[e]:"none"===t?void 0:t}))};return(0,l.jsx)(eo,{open:t,onOpenChange:n,children:(0,l.jsxs)(ec,{children:[(0,l.jsxs)(eu,{children:[(0,l.jsx)(em,{children:"Mapeamento de Colunas CSV"}),(0,l.jsx)(eh,{children:"Confirme ou selecione as colunas para latitude, longitude, altitude e orienta\xe7\xe3o."})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(P,{htmlFor:"lon-col",className:"text-right",children:"Longitude*"}),(0,l.jsxs)(U,{onValueChange:e=>h("lon",e),value:d.lon,children:[(0,l.jsx)(_,{id:"lon-col",className:"col-span-3",children:(0,l.jsx)(B,{placeholder:"Selecione a coluna"})}),(0,l.jsx)(G,{className:"max-h-[200px] overflow-y-auto",children:r.map(e=>(0,l.jsx)(H,{value:e,children:e},"lon-".concat(e)))})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(P,{htmlFor:"lat-col",className:"text-right",children:"Latitude*"}),(0,l.jsxs)(U,{onValueChange:e=>h("lat",e),value:d.lat,children:[(0,l.jsx)(_,{id:"lat-col",className:"col-span-3",children:(0,l.jsx)(B,{placeholder:"Selecione a coluna"})}),(0,l.jsx)(G,{className:"max-h-[200px] overflow-y-auto",children:r.map(e=>(0,l.jsx)(H,{value:e,children:e},"lat-".concat(e)))})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(P,{htmlFor:"alt-col",className:"text-right",children:"Altitude"}),(0,l.jsxs)(U,{onValueChange:e=>h("alt",e),value:d.alt,children:[(0,l.jsx)(_,{id:"alt-col",className:"col-span-3",children:(0,l.jsx)(B,{placeholder:"Coluna opcional"})}),(0,l.jsxs)(G,{className:"max-h-[200px] overflow-y-auto",children:[(0,l.jsx)(H,{value:"none",children:"Nenhuma"}),r.map(e=>(0,l.jsx)(H,{value:e,children:e},"alt-".concat(e)))]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(P,{htmlFor:"heading-col",className:"text-right",children:"Heading (deg)"}),(0,l.jsxs)(U,{onValueChange:e=>h("heading",e),value:d.heading,children:[(0,l.jsx)(_,{id:"heading-col",className:"col-span-3",children:(0,l.jsx)(B,{placeholder:"Coluna opcional"})}),(0,l.jsxs)(G,{className:"max-h-[200px] overflow-y-auto",children:[(0,l.jsx)(H,{value:"none",children:"Nenhuma"}),r.map(e=>(0,l.jsx)(H,{value:e,children:e},"heading-".concat(e)))]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,l.jsx)(P,{htmlFor:"gimbal-col",className:"text-right",children:"Gimbal Pitch"}),(0,l.jsxs)(U,{onValueChange:e=>h("gimbalPitch",e),value:d.gimbalPitch,children:[(0,l.jsx)(_,{id:"gimbal-col",className:"col-span-3",children:(0,l.jsx)(B,{placeholder:"Coluna opcional"})}),(0,l.jsxs)(G,{className:"max-h-[200px] overflow-y-auto",children:[(0,l.jsx)(H,{value:"none",children:"Nenhuma"}),r.map(e=>(0,l.jsx)(H,{value:e,children:e},"gimbal-".concat(e)))]})]})]}),u&&(0,l.jsx)("p",{className:"text-sm text-destructive col-span-4 text-center",children:u})]}),(0,l.jsxs)(ep,{children:[(0,l.jsx)(C.$,{variant:"outline",onClick:n,children:"Cancelar"}),(0,l.jsx)(C.$,{onClick:()=>{if(!d.lat||!d.lon)return void p("As colunas de Latitude e Longitude s\xe3o obrigat\xf3rias.");p(""),o({lat:d.lat,lon:d.lon,alt:d.alt,heading:d.heading,gimbalPitch:d.gimbalPitch})},children:"Importar"})]})]})})};var ew=a(7270);let eC=e=>{let{isOpen:t,onOpenChange:a}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.$,{variant:"outline",size:"icon",className:"fixed bottom-4 right-4 z-50 rounded-full h-14 w-14 shadow-lg bg-primary text-primary-foreground hover:bg-primary/90",onClick:()=>a(!0),children:(0,l.jsx)(ew.A,{className:"h-7 w-7"})}),(0,l.jsx)(eo,{open:t,onOpenChange:a,children:(0,l.jsxs)(ec,{className:"max-w-3xl h-[80vh] flex flex-col p-0",children:[(0,l.jsxs)(eu,{className:"p-6 pb-2",children:[(0,l.jsx)(em,{className:"text-2xl font-bold",children:"Ajuda - GeoFlightPlannerCamp"}),(0,l.jsx)(eh,{children:"Guia r\xe1pido para edi\xe7\xe3o de planos de voo."})]}),(0,l.jsx)(R,{className:"flex-1 px-6",children:(0,l.jsxs)("div",{className:"prose prose-sm lg:prose-base max-w-none text-foreground",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mt-4",children:"Qual o objetivo do App?"}),(0,l.jsxs)("p",{children:["Facilitar a edi\xe7\xe3o de campos dos arquivos .CSV gerados pelo plugin ",(0,l.jsx)("strong",{children:"GeoFlightPlanner"})," no QGIS. Esta ferramenta \xe9 ideal para quem precisa fazer ajustes finos no plano de voo diretamente em campo, de forma offline, usando um smartphone ou tablet."]}),(0,l.jsx)("h2",{className:"text-xl font-semibold mt-4",children:"Como Usar as Ferramentas?"}),(0,l.jsx)("h3",{className:"text-lg font-semibold mt-3",children:"Gerenciamento de Arquivos"}),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Importar CSV:"})," Carregue seu arquivo .CSV. O app tentar\xe1 detectar as colunas de coordenadas (latitude, longitude, altitude). Se n\xe3o conseguir, voc\xea poder\xe1 mape\xe1-las manualmente."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Exportar CSV:"})," Gera um novo arquivo .CSV com suas edi\xe7\xf5es, mantendo o formato e cabe\xe7alho originais, pronto para ser usado no Litchi."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Desfazer/Refazer:"})," Volte ou avance uma a\xe7\xe3o de edi\xe7\xe3o a qualquer momento."]})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mt-3",children:"Visualiza\xe7\xe3o"}),(0,l.jsx)("ul",{children:(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Zoom:"})," Use os bot\xf5es de zoom para aproximar, afastar, enquadrar todos os pontos ou focar apenas nos pontos selecionados."]})}),(0,l.jsx)("h3",{className:"text-lg font-semibold mt-3",children:"Sele\xe7\xe3o"}),(0,l.jsx)("p",{children:"Fei\xe7\xf5es selecionadas ficam destacadas em laranja. Apenas com pontos selecionados as ferramentas de edi\xe7\xe3o s\xe3o habilitadas."}),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Sele\xe7\xe3o \xdanica:"})," Toque em um ponto no mapa para selecion\xe1-lo."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Sele\xe7\xe3o por Pol\xedgono:"})," Desenhe uma \xe1rea no mapa para selecionar todos os pontos dentro dela. Finalize o desenho com o bot\xe3o que aparece na tela ou com o clique direito no PC."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Selecionar Tudo:"})," Um bot\xe3o que alterna entre selecionar e deselecionar todos os pontos do mapa."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Limpar Sele\xe7\xe3o:"})," Remove a sele\xe7\xe3o de todos os pontos."]})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mt-3",children:"Edi\xe7\xe3o"}),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Duplicar:"})," Cria uma c\xf3pia dos pontos selecionados."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Mover (Transla\xe7\xe3o):"})," Arraste os pontos selecionados no mapa ou edite os valores de delta (dLat, dLon, dAlt) no painel de atributos. Para alterar a altitude arrastando no mapa, trave um dos eixos (latitude ou longitude)."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Editar Atributos:"})," Edite os valores de qualquer campo para todos os pontos selecionados de uma s\xf3 vez. Deixe um campo em branco para manter os valores originais."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Excluir:"})," Remove permanentemente os pontos selecionados."]})]}),(0,l.jsx)("h2",{className:"text-xl font-semibold mt-4",children:"Layout da Tela"}),(0,l.jsx)("p",{children:"Use o bot\xe3o de troca de layout para alternar entre as visualiza\xe7\xf5es: tela dividida (mapa e atributos), somente mapa ou somente atributos. Na tela dividida, voc\xea pode arrastar a divis\xf3ria para redimensionar os pain\xe9is."})]})}),(0,l.jsxs)("div",{className:"p-6 border-t flex justify-between items-center",children:[(0,l.jsx)("a",{href:"https://www.portal.geoone.com",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:"Visite a GeoOne"}),(0,l.jsx)(ei,{asChild:!0,children:(0,l.jsx)(C.$,{variant:"outline",children:"Fechar"})})]})]})})]})},eS=e=>{let[t,a]=(0,s.useState)([e]),[l,n]=(0,s.useState)(0),o=(0,s.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=t[l],r="function"==typeof e?e(o):e;if(s||JSON.stringify(o)!==JSON.stringify(r))if(s){let e=[...t];e[l]=r,a(e)}else{let e=t.slice(0,l+1);e.push(r),a(e),n(e.length-1)}},[l,t]),r=(0,s.useCallback)(()=>{l>0&&n(e=>e-1)},[l]),i=(0,s.useCallback)(()=>{l<t.length-1&&n(e=>e+1)},[l,t.length]),d=(0,s.useCallback)(e=>{a([e]),n(0)},[]);return{state:t[l],setState:o,undo:r,redo:i,canUndo:l>0,canRedo:l<t.length-1,resetHistory:d}};var ek=a(3024);let eA={points:[],selectedPoints:new Set,originalHeaders:[],isDrawing:!1,drawnPolygon:[],selectionMode:"single",translationLock:{lat:!1,lon:!1,alt:!1},translationDelta:{dLat:0,dLon:0,dAlt:0},pointsBeforeTranslate:null,schema:{fields:[]},attributeQuery:null,rotationCenter:null,pointsBeforeRotate:null,selectionAddMode:!1},eM=()=>{let{state:e,setState:t,undo:a,redo:l,canUndo:n,canRedo:o,resetHistory:r}=eS(eA),{points:i,selectedPoints:d,originalHeaders:c,isDrawing:u,drawnPolygon:p,selectionMode:m,translationLock:h,translationDelta:x,pointsBeforeTranslate:g,schema:f,attributeQuery:v,rotationCenter:b,pointsBeforeRotate:j}=e||eA,y=(0,s.useCallback)(()=>{t(e=>e?e.pointsBeforeTranslate?{...e,points:e.pointsBeforeTranslate,pointsBeforeTranslate:null,translationDelta:{dLat:0,dLon:0,dAlt:0},selectionMode:"single"}:{...e,selectionMode:"single"}:eA,!1)},[t]),N=(0,s.useCallback)(e=>{t(t=>{if(!t)return eA;let a={...t};return"translate"===t.selectionMode&&"translate"!==e&&t.pointsBeforeTranslate&&(a.points=t.pointsBeforeTranslate),"rotate"===t.selectionMode&&"rotate"!==e&&t.pointsBeforeRotate&&(a.points=t.pointsBeforeRotate),a={...a,selectionMode:e,isDrawing:"polygon"===e,drawnPolygon:[],pointsBeforeTranslate:null,translationDelta:{dLat:0,dLon:0,dAlt:0},rotationCenter:null,pointsBeforeRotate:null},"polygon"===e?a.selectedPoints=new Set:"translate"===e&&t.selectedPoints.size>0?a.pointsBeforeTranslate=[...t.points]:"rotate"===e&&t.selectedPoints.size>1?a.pointsBeforeRotate=[...t.points]:"attribute"===e&&(a.attributeQuery=null),a})},[t]),w=(0,s.useCallback)(()=>{let e=0;return t(t=>{let a;if(!t||t.drawnPolygon.length<3)return{...t||eA,isDrawing:!1,selectionMode:"single",drawnPolygon:[]};let l=ek.n1([[...t.drawnPolygon.map(e=>[e.lng,e.lat]),[t.drawnPolygon[0].lng,t.drawnPolygon[0].lat]]]),s=new Set;return t.points.forEach(e=>{let t=ek.zx7([e.lon,e.lat]);ek.mFO(t,l)&&s.add(e.id)}),e=s.size,t.selectionAddMode?(a=new Set(t.selectedPoints),s.forEach(e=>a.add(e))):a=s,{...t,selectedPoints:a,drawnPolygon:[],isDrawing:!1,selectionMode:a.size>0?"batch-edit":"single"}},!0),e},[t]),C=(0,s.useCallback)(e=>{t(t=>{if(!t)return eA;if(t.selectionAddMode){let a=new Set(t.selectedPoints);return a.add(e),{...t,selectedPoints:a,selectionMode:"single"}}let a=new Set([e]);return 1===t.selectedPoints.size&&t.selectedPoints.has(e)?{...t,selectedPoints:new Set,selectionMode:"single"}:{...t,selectedPoints:a,selectionMode:"single"}},!0)},[t]),S=(0,s.useCallback)(e=>{t(t=>{if(!t)return eA;if(!e)return{...t,selectedPoints:new Set,selectionMode:"single"};{let e=new Set(t.points.map(e=>e.id));return{...t,selectedPoints:e,selectionMode:"all"}}},!0)},[t]),k=(0,s.useCallback)(()=>{t(e=>({...e||eA,selectedPoints:new Set,selectionMode:"single",selectionAddMode:!1}),!0)},[t]),A=(0,s.useCallback)(()=>{t(e=>{if(!e)return eA;let t=[...e.points],a=new Set;return e.points.forEach(l=>{if(e.selectedPoints.has(l.id)){let e={...l,id:"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():ex(),lon:l.lon+1e-4,lat:l.lat+1e-4};t.push(e),a.add(e.id)}}),{...e,points:t,selectedPoints:a}})},[t]),M=(0,s.useCallback)(()=>{t(e=>{if(!e)return eA;let t=e.points.filter(t=>!e.selectedPoints.has(t.id));return{...e,points:t,selectedPoints:new Set,selectionAddMode:!1}})},[t]),P=(0,s.useCallback)((e,a)=>{t(t=>{if(!t)return eA;let l=t.points.map(t=>t.id===e?{...t,...a}:t);return{...t,points:l}})},[t]),L=(0,s.useCallback)(e=>{t(t=>{if(!t)return eA;let{attributes:a,...l}=e,s=t.points.map(e=>{if(t.selectedPoints.has(e.id)){let t={...e,...l};return a&&(t.attributes={...e.attributes,...a}),t}return e});return{...t,points:s}})},[t]),F=(0,s.useCallback)(e=>{t(t=>{if(!t||!t.pointsBeforeTranslate)return t;let a=t.points.map(a=>a&&t.selectedPoints.has(a.id)?{...a,lat:a.lat+e.dLat,lon:a.lon+e.dLon,alt:null!==a.alt&&void 0!==a.alt?a.alt+e.dAlt:a.alt}:a);return{...t,points:a,translationDelta:{dLat:t.translationDelta.dLat+e.dLat,dLon:t.translationDelta.dLon+e.dLon,dAlt:t.translationDelta.dAlt+e.dAlt}}},!1)},[t]),z=(0,s.useCallback)(()=>{t(e=>e?{...e,pointsBeforeTranslate:null,translationDelta:{dLat:0,dLon:0,dAlt:0},selectionMode:"single"}:eA)},[t]),T=(0,s.useCallback)((e,a)=>{t(t=>t?{...t,translationLock:{...t.translationLock,[e]:a}}:eA,!0)},[t]),D=(0,s.useCallback)((e,a)=>{t(t=>{if(!t||!t.pointsBeforeTranslate)return t;let l=a-t.translationDelta[e],s={dLat:"dLat"===e?l:0,dLon:"dLon"===e?l:0,dAlt:"dAlt"===e?l:0},n=t.points.map(e=>e&&t.selectedPoints.has(e.id)?{...e,lat:e.lat+s.dLat,lon:e.lon+s.dLon,alt:null!==e.alt&&void 0!==e.alt?e.alt+s.dAlt:e.alt}:e);return{...t,points:n,translationDelta:{...t.translationDelta,[e]:a}}},!1)},[t]),E=(0,s.useCallback)(e=>{t(t=>({...t||eA,attributeQuery:e}))},[t]),R=(0,s.useCallback)(e=>{t(t=>({...t||eA,selectionAddMode:e}),!0)},[t]),I=(0,s.useCallback)(e=>{console.log("applyBatchSelection called with newIds:",Array.from(e)),t(t=>{let a;if(!t)return console.log("applyBatchSelection - prev is null, returning initialState"),eA;if(!e||0===e.size)return console.warn("No IDs provided for batch selection"),t;console.log("Current state:",{selectedPoints:Array.from(t.selectedPoints),selectionMode:t.selectionMode,addMode:t.selectionAddMode});let l=new Set(Array.from(e).filter(e=>t.points.some(t=>t.id===e)));console.log("Valid IDs for selection:",Array.from(l)),t.selectionAddMode?console.log("Add mode - combined selection:",Array.from(a=new Set([...Array.from(t.selectedPoints),...Array.from(l)]))):console.log("Replace mode - new selection:",Array.from(a=l)),0===a.size&&console.warn("No points selected after operation");let s={...t,selectedPoints:a,selectionMode:"batch-edit"};return console.log("Updating state with:",{selectionMode:s.selectionMode,selectedPointsCount:s.selectedPoints.size}),s},!0)},[t]),V=(0,s.useCallback)(()=>{t(e=>{let t;if(!e||!e.attributeQuery)return console.warn("No attribute query to apply"),e;console.log("Applying attribute selection with query:",e.attributeQuery);let{field:a,operator:l,value:s,values:n,min:o,max:r}=e.attributeQuery,i=new Set;return e.selectionAddMode&&(console.log("Using existing selection as base:",Array.from(e.selectedPoints)),i=new Set(e.selectedPoints)),console.log("Evaluating points for field:",a),e.points.forEach(e=>{if(!e.id)return void console.warn("Point without ID found:",e);let t=e.attributes[a];console.log("Evaluating point:",{id:e.id,value:t});let d=!1;switch(l){case"eq":d=String(t)===String(s);break;case"neq":d=String(t)!==String(s);break;case"in":d=!!(null==n?void 0:n.some(e=>String(e)===String(t)));break;case"gte":d="number"==typeof t&&"number"==typeof s&&t>=s;break;case"lte":d="number"==typeof t&&"number"==typeof s&&t<=s;break;case"between":d="number"==typeof t&&"number"==typeof o&&"number"==typeof r&&t>=o&&t<=r}d&&i.add(e.id)}),e.selectionAddMode?(t=new Set(e.selectedPoints),i.forEach(e=>t.add(e))):t=i,{...e,selectedPoints:t,attributeQuery:null,selectionMode:t.size>0?"batch-edit":"single"}},!0)},[t]),O=(0,s.useCallback)(e=>{t(t=>({...t||eA,rotationCenter:e}),!0)},[t]),q=(0,s.useCallback)(e=>{t(t=>{if(!t||!t.rotationCenter)return t;let a=t.points,l=ek.zx7([t.rotationCenter.lon,t.rotationCenter.lat]),s=a.map(a=>{if(t.selectedPoints.has(a.id)){let t=ek.zx7([a.lon,a.lat]),s=ek.qS_(t,e,{pivot:l});return{...a,lon:s.geometry.coordinates[0],lat:s.geometry.coordinates[1]}}return a});return{...t,points:s}},!1)},[t]),U=(0,s.useCallback)(()=>{t(e=>e&&e.pointsBeforeRotate?{...e,pointsBeforeRotate:null,rotationCenter:null,selectionMode:"single"}:e)},[t]),B=(0,s.useCallback)(()=>{t(e=>{if(!e||!e.points||e.points.length<2)return e;let t=[...e.points].reverse();return{...e,points:t}})},[t]);return{points:i||[],selectedPoints:d||new Set,originalHeaders:c||[],history:e,canUndo:n,canRedo:o,undo:a,redo:l,resetHistory:r,finishPolygonSelection:w,updatePoint:P,updateSelectedPoints:L,togglePointSelection:C,clearSelection:k,selectAll:S,duplicateSelectedPoints:A,deleteSelectedPoints:M,isDrawing:u||!1,setIsDrawing:e=>t(t=>({...t||eA,isDrawing:e}),!0),drawnPolygon:p||[],setDrawnPolygon:e=>t(t=>({...t||eA,drawnPolygon:"function"==typeof e?e((null==t?void 0:t.drawnPolygon)||[]):e}),!0),selectionMode:m||"single",setSelectionMode:N,translationLock:h||{lat:!1,lon:!1,alt:!1},setTranslationLock:T,translateSelectedPoints:F,translationDelta:x||{dLat:0,dLon:0,dAlt:0},setTranslationValue:D,applyTranslation:z,cancelTranslation:y,schema:f,attributeQuery:v,setAttributeQuery:E,applyAttributeSelection:V,applyBatchSelection:I,rotationCenter:b,setRotationCenter:O,rotateSelectedPoints:q,applyRotation:U,selectionAddMode:(null==e?void 0:e.selectionAddMode)||!1,setSelectionAddMode:R,reverseFlightPoints:B}};var eP=a(295),eL=a(9730);function eF(e){let{className:t,...a}=e;return(0,l.jsx)(eL.YZ,{"data-slot":"resizable-panel-group",className:(0,S.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...a})}function ez(e){let{...t}=e;return(0,l.jsx)(eL.Zk,{"data-slot":"resizable-panel",...t})}function eT(e){let{withHandle:t,className:a,...s}=e;return(0,l.jsx)(eL.TW,{"data-slot":"resizable-handle",className:(0,S.cn)("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",a),...s,children:t&&(0,l.jsx)("div",{className:"bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border",children:(0,l.jsx)(eP.A,{className:"size-2.5"})})})}let eD=(0,h.default)(()=>Promise.all([a.e(399),a.e(112)]).then(a.bind(a,7731)),{loadableGenerated:{webpack:()=>[7731]},ssr:!1}),eE=[{id:"voyager",label:"Voyager"},{id:"osm",label:"OSM"},{id:"dark-voyager",label:"Voyager Escuro"},{id:"opentopo",label:"OpenTopoMap (Topogr\xe1fico)"}],eR=()=>{let{toast:e}=(0,n.dj)(),t=(0,s.useRef)(null),[a,o]=(0,s.useState)("side-by-side"),[r,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1),[h,x]=(0,s.useState)(eE[0].id),{points:g,selectedPoints:f,originalHeaders:v,canUndo:b,canRedo:j,undo:y,redo:N,resetHistory:w,updatePoint:C,updateSelectedPoints:k,togglePointSelection:A,clearSelection:M,selectionMode:P,setSelectionMode:L,drawnPolygon:F,isDrawing:z,setDrawnPolygon:T,finishPolygonSelection:D,duplicateSelectedPoints:E,deleteSelectedPoints:R,translationLock:I,setTranslationLock:V,translationDelta:O,setTranslationValue:q,translateSelectedPoints:U,applyTranslation:B,cancelTranslation:_,selectAll:$}=eM(),Q=(0,s.useRef)(!1),G=(0,s.useRef)(null),H=(0,s.useRef)(g.length),Z=(0,s.useRef)(f.size),J=(0,s.useCallback)(()=>{if(g.length>0&&t.current){let e=g.map(e=>e.lon),a=g.map(e=>e.lat);t.current.fitBounds([[Math.min(...e),Math.min(...a)],[Math.max(...e),Math.max(...a)]],{padding:60,duration:1e3})}},[g]),Y=(0,s.useCallback)(()=>{let e=g.filter(e=>f.has(e.id));if(e.length>0&&t.current){let a=e.map(e=>e.lon),l=e.map(e=>e.lat);t.current.fitBounds([[Math.min(...a),Math.min(...l)],[Math.max(...a),Math.max(...l)]],{padding:60,duration:1e3})}},[g,f]),K=(0,s.useCallback)((e,t)=>{console.log("Point clicked:",e,"Selection mode:",P),t&&t.originalEvent.stopPropagation(),z||(console.log("Toggling selection for point:",e),A(e))},[z,A]),W=(0,s.useCallback)(e=>{if(console.log("Map clicked. Selection mode:",P,"Is translating:",Q.current),Q.current)return void console.log("Ignoring click because translation is in progress");e.features&&e.features.length>0||("single"===P&&f.size>0&&(console.log("Clearing selection because clicked outside point"),M()),z&&(console.log("Adding point to drawn polygon"),T(t=>[...t,{lng:e.lngLat.lng,lat:e.lngLat.lat}])))},[z,T,Q,P,f.size,M]),X=(0,s.useCallback)(e=>{"translate"===P&&f.size>0&&(Q.current=!0,G.current={lng:e.lngLat.lng,lat:e.lngLat.lat},t.current&&(t.current.getMap().getCanvas().style.cursor="move"),e.preventDefault())},[P,f.size]),ee=(0,s.useCallback)(e=>{if(Q.current&&G.current&&e.originalEvent){let t=e.lngLat.lng-G.current.lng,a=e.lngLat.lat-G.current.lat,l=-(.5*e.originalEvent.movementY);I.lat&&(a=0),I.lon&&(t=0),I.alt&&(l=0),U({dLat:a,dLon:t,dAlt:l}),G.current={lng:e.lngLat.lng,lat:e.lngLat.lat}}},[U,I]),et=(0,s.useCallback)(()=>{Q.current&&(Q.current=!1,G.current=null,t.current&&(t.current.getMap().getCanvas().style.cursor=""))},[]),el=(0,s.useCallback)(()=>{let t=D();e({title:"Sele\xe7\xe3o por Pol\xedgono",description:"".concat(t," pontos selecionados")})},[D,e]),es=(0,s.useCallback)(e=>{e.preventDefault(),z&&el()},[z,el]);(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(z?L("single"):"translate"===P&&_()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.preventDefault(),y()),(e.ctrlKey||e.metaKey)&&"y"===e.key&&(e.preventDefault(),N()),"Delete"===e.key&&f.size>0&&R()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[z,y,N,f,R,L,P,_,J]);let en=async t=>{if(d)try{let{points:a,headers:l}=await ej(d,t);w({points:a,selectedPoints:new Set,originalHeaders:l,isDrawing:!1,drawnPolygon:[],selectionMode:"single",translationLock:{lat:!1,lon:!1,alt:!1},translationDelta:{dLat:0,dLon:0,dAlt:0},pointsBeforeTranslate:null}),e({title:"Importa\xe7\xe3o Bem-sucedida",description:"".concat(a.length," pontos carregados")}),i(!1),c(null)}catch(t){e({variant:"destructive",title:"Erro na Importa\xe7\xe3o",description:t.message})}},eo=(0,l.jsxs)("div",{className:"w-full h-full relative",children:[(0,l.jsx)(m,{mapRef:t,points:g,selectedPointIds:f,onPointClick:K,isDrawing:z,drawnPolygon:F,onMapClick:W,onMouseDown:X,onMouseMove:ee,onMouseUp:et,onTouchStart:X,onTouchMove:ee,onTouchEnd:et,onContextMenu:es,selectionMode:P,basemap:h}),z&&(0,l.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground rounded-lg px-4 py-2 text-sm z-10 shadow-lg flex flex-col items-center gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Desenhando pol\xedgono..."}),(0,l.jsx)("p",{className:"text-xs",children:"Toque no mapa para adicionar pontos."})]}),(0,l.jsx)("button",{onClick:el,className:"mt-2 bg-primary-foreground text-primary font-bold py-1 px-3 rounded-md text-sm",children:"Finalizar Desenho"})]})]}),er=(0,l.jsx)(ea,{points:g,originalHeaders:v,selectedPoints:Array.from(f),onUpdatePoint:(e,t)=>{C(e,t)},onUpdateSelectedPoints:e=>{k(e)},onTogglePointSelection:A,selectionMode:P,translationLock:I,onTranslationLockChange:V,translationDelta:O,onApplyTranslation:()=>{B(),e({title:"Transla\xe7\xe3o Aplicada",description:"As posi\xe7\xf5es dos pontos foram atualizadas."})},onSetTranslationValue:q});(0,s.useEffect)(()=>{let e=g.length>0&&0===H.current,t=0===f.size&&Z.current>0;e||t?setTimeout(()=>J(),100):!(f.size>0)||f.size===Z.current||z||"translate"===P||Q.current||Y(),H.current=g.length,Z.current=f.size},[g,f]);let[ei,ed]=(0,s.useState)(!1);return(0,s.useEffect)(()=>ed(!0),[]),(0,l.jsxs)("div",{className:"w-full h-screen flex flex-col bg-gray-50",children:[ei&&(0,l.jsx)(eD,{onImportRequest:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(c(a),i(!0)),e.target.value=""},onExport:()=>{if(0===g.length)return void e({variant:"destructive",title:"Exportar falhou",description:"N\xe3o h\xe1 pontos para exportar."});try{let t=ey(g,v);(0,S.t)(t,"pontos_editados.csv"),e({title:"Exporta\xe7\xe3o Bem-sucedida",description:"".concat(g.length," pontos exportados.")})}catch(t){e({variant:"destructive",title:"Erro na Exporta\xe7\xe3o",description:t.message})}},onUndo:y,onRedo:N,canUndo:b,canRedo:j,selectionMode:P,setSelectionMode:L,onClearSelection:()=>{M()},onSelectAll:$,isDrawing:z,hasData:g.length>0,onZoomToSelected:Y,hasSelection:f.size>0,onZoomAll:J,onZoomIn:()=>{var e;return null==(e=t.current)?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null==(e=t.current)?void 0:e.zoomOut()},onDuplicate:()=>{E()},onDelete:()=>{R()},viewMode:a,onToggleViewMode:()=>{o(e=>"side-by-side"===e?"map-only":"map-only"===e?"attributes-only":"side-by-side")},basemap:h,onBasemapChange:x,basemapOptions:eE,onHelp:()=>p(!0)}),(0,l.jsx)("div",{className:"flex-1 relative",children:(()=>{switch(a){case"map-only":return eo;case"attributes-only":return(0,l.jsx)("div",{className:"w-full h-full overflow-y-auto",children:er});default:return(0,l.jsxs)(eF,{direction:"horizontal",className:"w-full h-full",children:[(0,l.jsx)(ez,{defaultSize:65,children:eo}),(0,l.jsx)(eT,{withHandle:!0,className:"my-handle"}),(0,l.jsx)(ez,{defaultSize:35,children:(0,l.jsx)("div",{className:"w-full h-full overflow-y-auto",children:er})})]})}})()}),d&&(0,l.jsx)(eN,{file:d,isOpen:r,onClose:()=>{i(!1),c(null)},onSubmit:en}),(0,l.jsx)(eC,{isOpen:u,onOpenChange:p})]})}},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n,t:()=>o});var l=a(2596),s=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,l.$)(t))}let o=(e,t)=>{let a=new Blob([e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");if(void 0!==l.download){let e=URL.createObjectURL(a);l.setAttribute("href",e),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}},e=>{var t=t=>e(e.s=t);e.O(0,[600,668,965,382,441,684,358],()=>t(3067)),_N_E=e.O()}]);